---
- name: configure cluster
  hosts: all
  become: true
  tasks:
- name: individual node configuration 
  import_playbook: ./configure-node.yaml
- name: configure haproxy loadbalancer
  import_playbook: ./configure-lb.yaml
- name: configure kubespray globals
  import_playbook: ./configure-kubespray.yaml

- name: install kubespray
  hosts: all
  become: true
  tasks:
    # load kubespray global vars
    - name: Load kubespray variables
      include_vars: ./kubespray-global-vars.yaml
- name: run kubespray playbook
  import_playbook: ./kubespray/cluster.yml


- name: post kubespray configuration
  import_playbook: ./post-kubespray-configuration.yaml

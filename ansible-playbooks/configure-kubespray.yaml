---
- name: configure kubespray global vars
  hosts: localhost
  become: true
  tasks:
    - name: add metallb global vars for kubespray
      become: false
      delegate_to: localhost
      blockinfile:
        marker: "# {mark} metallb and ingress config" 
        mode: "0644"
        path: kubespray-global-vars.yaml
        block: |
          # enable local_path storage
          local_path_provisioner_enabled: true
          # enable metallb
          kube_proxy_strict_arp: true
          metallb_enabled: true
          metallb_speaker_enabled: true
          metallb_ip_range:
            - 192.168.200.253-192.168.200.254
          # export kubeconfig after cluster creation
          artifacts_dir: ./kubespray_artifacts
          kubeconfig_localhost: true
